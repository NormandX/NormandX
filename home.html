<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>NormandX</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="logo" onclick="location.href='home.html'">
    <span>Normand</span><span>X</span>
  </div>
  <input class="search" placeholder="Rechercher..." oninput="search(this.value)">
  <div class="account" onclick="toggleMenu()">
    <img src="https://ia600401.us.archive.org/33/items/person_avatar_account_user_icon_191606/person_avatar_account_user_icon_191606.webp">
  </div>
</header>

<div class="menu" id="menu">
  <a href="favorites.html">Favoris</a>
  <a href="history.html">Historique</a>
  <a onclick="logout()">Déconnexion</a>
</div>

<div class="layout">
<aside>
  <a onclick="filter('Hetero')">Hétéro</a>
  <a onclick="filter('MILF')">MILF</a>
</aside>

<main>
  <div class="grid" id="grid"></div>
</main>
</div>

<script>
const user = localStorage.getItem("connected");
if(!user) location.href="auth.html";

function toggleMenu(){
 menu.style.display = menu.style.display==="block"?"none":"block";
}
function logout(){
 localStorage.removeItem("connected");
 location.href="auth.html";
}

/* ===== VIDEOS ===== */
const videos = [
 {
  id:1,
  t:"Carla Cute 1",
  c:"Hetero",
  poster:"thumbs/1.jpg",
  v:"https://ia601703.us.archive.org/22/items/video-1_20260114/Video1.mp4",
  d:"12:34",
  hd:true,
  views:0
 }
];

localStorage.setItem("videos", JSON.stringify(videos));

function render(list){
 grid.innerHTML="";
 list.forEach(v=>{
  grid.innerHTML+=`
  <div class="card" onclick="openVideo(${v.id})">
    <div class="thumb"
      onmouseenter="previewStart(this)"
      onmouseleave="previewStop(this)">
      <video muted playsinline preload="metadata" poster="${v.poster}">
        <source src="${v.v}" type="video/mp4">
      </video>
      ${v.hd?'<span class="badge">HD</span>':''}
      <span class="duration">${v.d}</span>
      <div class="progress"><div></div></div>
    </div>

    <p>${v.t}</p>
    <div class="meta">
      <span>${v.views} vues</span>
      <span>${v.c}</span>
    </div>

    <div class="actions" onclick="event.stopPropagation()">
      <button onclick="toggleFav(${v.id})">❤</button>
    </div>
  </div>`;
 });
}
render(videos);

/* ===== PREVIEW DESKTOP + MOBILE ===== */
let hoverTimer, activeVideo;

function previewStart(el){
 const video = el.querySelector("video");
 const bar = el.querySelector(".progress div");

 if(activeVideo && activeVideo!==video){
  activeVideo.pause();
  activeVideo.currentTime=0;
 }
 activeVideo = video;

 hoverTimer = setTimeout(()=>{
  video.currentTime=0;
  video.play();
  video.ontimeupdate=()=>{
   bar.style.width=(video.currentTime/video.duration*100)+"%";
  };
 },300);
}

function previewStop(el){
 clearTimeout(hoverTimer);
 const video = el.querySelector("video");
 const bar = el.querySelector(".progress div");
 video.pause();
 video.currentTime=0;
 bar.style.width="0%";
}

document.addEventListener("touchstart",e=>{
 const t=e.target.closest(".thumb");
 if(t) previewStart(t);
},{passive:true});

document.addEventListener("touchend",e=>{
 const t=e.target.closest(".thumb");
 if(t) previewStop(t);
});

function openVideo(id){
 location.href="video.html?id="+id;
}

function toggleFav(id){
 const k="fav_"+user;
 let fav=JSON.parse(localStorage.getItem(k)||"[]");
 fav=fav.includes(id)?fav.filter(x=>x!==id):[...fav,id];
 localStorage.setItem(k,JSON.stringify(fav));
}

function search(q){
 render(videos.filter(v=>v.t.toLowerCase().includes(q.toLowerCase())));
}
function filter(c){
 render(videos.filter(v=>v.c===c));
}
</script>

</body>
</html>

