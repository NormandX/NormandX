<script>
/* ===== AUTH ===== */
const user = localStorage.getItem("connected") || "guest";
localStorage.setItem("connected", user);

/* ===== MENU ===== */
function toggleMenu(){
  const m=document.getElementById("menu");
  m.style.display = m.style.display==="block"?"none":"block";
}
function logout(){
  localStorage.removeItem("connected");
  location.reload();
}

/* ===== DATA ===== */
const videos=[
 {
  id:1,
  t:"Carla Cute 1",
  c:"Hetero",
  poster:"https://via.placeholder.com/640x360/111/ffffff?text=Video+1",
  v:"https://ia601703.us.archive.org/22/items/video-1_20260114/Video1.mp4",
  d:"12:34",
  views:0,
  hd:true,
  isNew:true
 },
 {
  id:2,
  t:"Ma cousine m'a fait perdre le NNN",
  c:"Hetero",
  poster:"https://ic-nss.flixcdn.com/a/MzliYTZhMDJhMWU2ZjNkNjY4NGRmOGI3NTI1MjQ1Zjg/webp%2Cs%28w%3A704%2Ch%3A440%29/xc/7k/7k6BvI/frame/original/23.jpg",
  v:"https://ia601402.us.archive.org/0/items/xnxx-incroyable-blonde-bien-roulee-percee-par-filoufitt-360p/XNXX_incroyable_blonde_bien_roulee_percee_par_filoufitt_360p.mp4",
  d:"18:05",
  views:0,
  hd:true,
  isNew:false
 }
];

localStorage.setItem("videos", JSON.stringify(videos));

/* ===== FAVORIS ===== */
let favorites = JSON.parse(localStorage.getItem("fav_"+user) || "[]");

/* ===== RENDER ===== */
const grid=document.getElementById("grid");

function render(list){
  grid.innerHTML="";
  list.forEach(v=>{
    const card=document.createElement("div");
    card.className="card";
    card.onclick=()=>{
      addHistory(v.id);
      location.href="video.html?id="+v.id;
    };

    card.innerHTML=`
      <div class="thumb"
        onmouseenter="previewStart(this)"
        onmouseleave="previewStop(this)">
        <img src="${v.poster}">
        <video muted playsinline preload="metadata">
          <source src="${v.v}" type="video/mp4">
        </video>
        ${v.hd?'<span class="badge">HD</span>':''}
        ${v.isNew?'<span class="badge new">NEW</span>':''}
        <span class="duration">${v.d}</span>
      </div>

      <div class="fav-row">
        <button class="fav-btn ${favorites.includes(v.id)?'active':''}"
          data-id="${v.id}"
          onclick="toggleFav(event,${v.id})">‚ù§</button>
      </div>

      <p>${v.t}</p>
      <div class="meta">
        <span>${v.views} vues</span>
        <span>${v.c}</span>
      </div>
    `;
    grid.appendChild(card);
  });
}

function toggleFav(e,id){
 e.stopPropagation();
 favorites.includes(id)
  ? favorites=favorites.filter(x=>x!==id)
  : favorites.push(id);
 localStorage.setItem("fav_"+user,JSON.stringify(favorites));
 render(videos);
}

function addHistory(id){
 let h=JSON.parse(localStorage.getItem("history_"+user)||"[]");
 h=h.filter(x=>x!==id);
 h.unshift(id);
 localStorage.setItem("history_"+user,JSON.stringify(h));
}

render(videos);

/* ===== PREVIEW PC ===== */
function previewStart(el){
 if(window.innerWidth<900) return;
 const v=el.querySelector("video");
 const i=el.querySelector("img");
 v.currentTime=0.1;
 v.oncanplay=()=>{
  i.style.opacity=0;
  v.style.opacity=1;
  v.play();
 };
}
function previewStop(el){
 const v=el.querySelector("video");
 const i=el.querySelector("img");
 v.pause();
 v.style.opacity=0;
 i.style.opacity=1;
}
</script>
