<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vidéo</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
 <div class="back" onclick="history.back()">← Retour</div>
</header>

<main class="player-page">
 <video id="player" controls playsinline></video>
</main>

<script>
const user=localStorage.getItem("connected");
if(!user) location.href="auth.html";

const id=Number(new URLSearchParams(location.search).get("id"));
let videos=JSON.parse(localStorage.getItem("videos"));
const v=videos.find(x=>x.id===id);

const player=document.getElementById("player");
player.src=v.v;
player.poster=v.poster;

/* vues */
v.views++;
localStorage.setItem("videos",JSON.stringify(videos));

/* historique */
let h=JSON.parse(localStorage.getItem("history_"+user)||"[]");
if(!h.includes(id)){h.unshift(id);}
localStorage.setItem("history_"+user,JSON.stringify(h));

/* plein écran mobile */
player.addEventListener("play",()=>{
 if(window.innerWidth<900){
  if(player.requestFullscreen) player.requestFullscreen();
 }
});
</script>

</body>
</html>
